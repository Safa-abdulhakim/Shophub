<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>🛍️ مُجمّع المتاجر — مشروع احترافي (بدون بناء)</title>

  <!-- خطوط و أيقونات و CSS -->
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet">
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css" rel="stylesheet">

  <style>
    :root{
      --bg: #f6f9fc;
      --surface: #ffffff;
      --text: #0f172a;
      --muted: #64748b;
      --accent: #2563eb;
      --danger: #ef4444;
      --glass: rgba(255,255,255,0.6);
      --shadow: 0 10px 40px rgba(2,6,23,.06);
    }
    [data-theme="dark"]{
      --bg:#071025;
      --surface:#071226;
      --text:#dbeafe;
      --muted:#98a2b3;
      --glass: rgba(10,12,18,0.6);
      --accent:#60a5fa;
      --danger:#f87171;
      --shadow: 0 14px 50px rgba(0,0,0,.6);
    }

    html,body{height:100%}
    body{
      font-family:"Tajawal",system-ui,-apple-system,"Segoe UI",Roboto,Arial;
      background: radial-gradient(800px 400px at 10% 0%, rgba(37,99,235,0.04), transparent 10%), var(--bg);
      color:var(--text);
      -webkit-font-smoothing:antialiased;
    }

    .app-navbar{ background: linear-gradient(90deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02)); box-shadow: var(--shadow); }
    .brand{ font-weight:700; letter-spacing:.2px; }
    .theme-toggle{ border:0; background:transparent; color:var(--text); padding:.35rem .6rem; border-radius:10px; border:1px solid color-mix(in srgb,var(--muted) 12%, transparent) }
    .clock{ font-weight:600; color:var(--muted) }

    .hero{ min-height:36vh; display:grid; place-items:center; text-align:center; padding:2.5rem 1rem; }
    .card-store{ border-radius:12px; overflow:hidden; transition: transform .15s ease, box-shadow .15s ease; border:1px solid color-mix(in srgb,var(--muted) 8%, transparent); background: linear-gradient(180deg,var(--surface), color-mix(in srgb,var(--surface) 96%, transparent)); }
    .card-store:hover{ transform:translateY(-6px); box-shadow: 0 24px 60px rgba(2,6,23,.08); }
    .thumb{ width:100%; height:140px; object-fit:cover; background:#eef2ff }

    .tag{ font-size:.72rem; padding:.18rem .45rem; border-radius:999px; border:1px solid color-mix(in srgb,var(--muted) 10%, transparent); margin-inline:.2rem; display:inline-block; background: color-mix(in srgb,var(--surface) 92%, transparent) }
    .muted{ color:var(--muted) }

    .offcanvas{ width:360px !important; max-width:95% }
    footer{ padding:2rem 0; color:var(--muted); text-align:center }

    /* animation for favorites items */
    @keyframes fadeInUp { from { opacity:0; transform: translateY(8px);} to { opacity:1; transform: translateY(0);} }
  </style>
</head>
<body>
<div id="root"></div>

<!-- libs -->
<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>
<script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

<script type="text/babel">
const { useState, useEffect, useMemo, useRef } = React;

/* ---------- helpers ---------- */
const THEME_KEY = "stores_theme_v2";
const FAV_KEY = "stores_favs_v2";
const getInitialTheme = ()=> localStorage.getItem(THEME_KEY) || (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? "dark" : "light");
const applyTheme = t => { document.documentElement.setAttribute('data-theme', t); localStorage.setItem(THEME_KEY, t); };
const favicon = d => `https://www.google.com/s2/favicons?domain=${d}&sz=128`;

/* ---------- sample stores (قابلة للإضافة بسهولة) ---------- */
const STORES = [
  { id:"amazon", name:"Amazon", domain:"amazon.com", url:"https://www.amazon.com/", country:"US", type:"Marketplace", rating:4.6, price:"mixed", categories:["Electronics","Books","Home"], tags:["Prime","Global"], desc:"من أكبر المتاجر عالمياً مع تشكيلة واسعة.", freeShipping:true, deliveryDays:3 },
  { id:"alibaba", name:"Alibaba", domain:"alibaba.com", url:"https://www.alibaba.com/", country:"CN", type:"Wholesale", rating:4.4, price:"wholesale", categories:["Wholesale","Manufacturing"], tags:["B2B","Suppliers"], desc:"منصة تجارة بالجملة تربط الموردين بالمشترين.", freeShipping:false, deliveryDays:14 },
  { id:"aliexpress", name:"AliExpress", domain:"aliexpress.com", url:"https://www.aliexpress.com/", country:"CN", type:"Marketplace", rating:4.3, price:"low", categories:["Electronics","Fashion"], tags:["Affordable","Global shipping"], desc:"متجر موجه للمستهلك مع شحن دولي.", freeShipping:false, deliveryDays:12 },
  { id:"shein", name:"SHEIN", domain:"shein.com", url:"https://www.shein.com/", country:"CN", type:"Fashion", rating:4.2, price:"low", categories:["Fashion","Women"], tags:["Fast-fashion","Trendy"], desc:"متجر أزياء عالمي بأسعار منخفضة.", freeShipping:false, deliveryDays:10 },
  { id:"ebay", name:"eBay", domain:"ebay.com", url:"https://www.ebay.com/", country:"US", type:"Marketplace", rating:4.1, price:"varied", categories:["Auctions","Collectibles"], tags:["Auctions","Used"], desc:"منصة مزادات وبائعين فرديين.", freeShipping:false, deliveryDays:7 },
  { id:"walmart", name:"Walmart", domain:"walmart.com", url:"https://www.walmart.com/", country:"US", type:"Retail", rating:4.0, price:"mixed", categories:["Grocery","Electronics"], tags:["Superstore","Local pickup"], desc:"سلسلة متاجر مع خيارات استلام محلي.", freeShipping:true, deliveryDays:2 },
  { id:"etsy", name:"Etsy", domain:"etsy.com", url:"https://www.etsy.com/", country:"US", type:"Marketplace", rating:4.5, price:"varied", categories:["Handmade","Art"], tags:["Handmade","Crafts"], desc:"منتجات حرفية وفريدة من البائعين المستقلين.", freeShipping:false, deliveryDays:8 },
  { id:"noon", name:"Noon", domain:"noon.com", url:"https://www.noon.com/", country:"AE", type:"Marketplace", rating:4.0, price:"mixed", categories:["Electronics","Fashion"], tags:["MENA","Retail"], desc:"متجر إقليمي في منطقة الشرق الأوسط.", freeShipping:true, deliveryDays:4 },
  { id:"jumia", name:"Jumia", domain:"jumia.com", url:"https://www.jumia.com/", country:"NG", type:"Marketplace", rating:4.0, price:"mixed", categories:["Electronics","Fashion","Grocery"], tags:["Africa","Retail"], desc:"منصة رائدة للتجارة الإلكترونية بأفريقيا.", freeShipping:false, deliveryDays:9 },
  { id:"carrefour", name:"Carrefour", domain:"carrefour.com", url:"https://www.carrefour.com/", country:"FR", type:"Retail", rating:4.1, price:"mixed", categories:["Grocery","Home"], tags:["Supermarket"], desc:"سلسلة متاجر عالمية مع خدمة أونلاين.", freeShipping:true, deliveryDays:3 },
  { id:"taobao", name:"Taobao", domain:"taobao.com", url:"https://www.taobao.com/", country:"CN", type:"Marketplace", rating:4.2, price:"low", categories:["Everything"], tags:["China","Local"], desc:"سوق صيني شهير متعدد الأقسام.", freeShipping:false, deliveryDays:12 },
];

/* ---------- utility lists ---------- */
const categoriesAll = Array.from(new Set(STORES.flatMap(s=>s.categories))).sort();
const countriesAll = Array.from(new Set(STORES.map(s=>s.country))).sort();
const typesAll = Array.from(new Set(STORES.map(s=>s.type))).sort();

/* ---------- small helpers ---------- */
function notify(text, type="info"){
  Toastify({
    text, duration: 1800, gravity: "top", position: "center", close: true,
    className: type==="success" ? "bg-success" : (type==="danger" ? "bg-danger" : "bg-dark")
  }).showToast();
}

/* ========== Components ========== */

function Topbar({ query, setQuery, theme, toggleTheme, favCount, timeStr }) {
  const inputRef = useRef(null);
  useEffect(()=>{ inputRef.current && inputRef.current.focus(); },[]);
  return (
    <nav className="navbar app-navbar navbar-expand-lg sticky-top py-3">
      <div className="container">
        <a className="navbar-brand brand d-flex align-items-center gap-2" href="#">
          <i className="fa-solid fa-store fa-lg"></i>
          <span>مجمّع المتاجر</span>
        </a>

        <button className="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navmenu">
          <span className="navbar-toggler-icon"></span>
        </button>

        <div className="collapse navbar-collapse" id="navmenu">
          <form onSubmit={e=>e.preventDefault()} className="ms-auto d-flex gap-2 align-items-center w-100 w-lg-auto">
            <div className="input-group search-box" style={{maxWidth:720}}>
              <span className="input-group-text bg-transparent border-end-0"><i className="fa-solid fa-magnifying-glass"></i></span>
              <input ref={inputRef} value={query} onChange={e=>setQuery(e.target.value)} className="form-control form-control-lg border-start-0" placeholder="ابحث عن متجر، وسم، أو تصنيف... (بحث حي)" />
            </div>
          </form>

          <div className="d-flex align-items-center gap-2 ms-3">
            <div className="clock muted me-2">{timeStr}</div>
            <button className="theme-toggle" onClick={toggleTheme}>{theme==="dark" ? <><i className="fa-solid fa-sun me-1"></i> فاتح</> : <><i className="fa-solid fa-moon me-1"></i> داكن</>}</button>
            <button className="btn btn-outline-light position-relative" data-bs-toggle="offcanvas" data-bs-target="#favCanvas">
              <i className="fa-solid fa-heart"></i>
              {favCount>0 && <span className="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">{favCount}</span>}
            </button>
          </div>
        </div>
      </div>
    </nav>
  );
}

function Hero(){
  return (
    <header className="hero">
      <div className="container" data-aos="fade-up">
        <span className="badge bg-light text-dark rounded-pill px-3 py-2">مشروع الدورة — منصة متاجر</span>
        <h1 className="fw-bold mt-3">ابحث، قارن، وزُر أشهر المتاجر الإلكترونية من مكان واحد</h1>
        <p className="lead muted">بحث حي، تصنيفات، شحن مجاني، مفضلة، وصف مفصّل لكل متجر.</p>
      </div>
    </header>
  );
}

function Filters({ filters, setFilters, sortBy, setSortBy, clearAll }) {
  return (
    <div className="container mb-3">
      <div className="card shadow-soft p-3">
        <div className="row g-2 align-items-end">
          <div className="col-6 col-md-3">
            <label className="form-label small">التصنيف</label>
            <select className="form-select" value={filters.category} onChange={e=>setFilters(f=>({...f,category:e.target.value}))}>
              <option value="">الكل</option>
              {categoriesAll.map(c=> <option key={c} value={c}>{c}</option>)}
            </select>
          </div>

          <div className="col-6 col-md-3">
            <label className="form-label small">البلد</label>
            <select className="form-select" value={filters.country} onChange={e=>setFilters(f=>({...f,country:e.target.value}))}>
              <option value="">الكل</option>
              {countriesAll.map(c=> <option key={c} value={c}>{c}</option>)}
            </select>
          </div>

          <div className="col-6 col-md-2">
            <label className="form-label small">نوع البائع</label>
            <select className="form-select" value={filters.type} onChange={e=>setFilters(f=>({...f,type:e.target.value}))}>
              <option value="">الكل</option>
              {typesAll.map(t=> <option key={t} value={t}>{t}</option>)}
            </select>
          </div>

          <div className="col-6 col-md-2">
            <label className="form-label small">شحن مجاني</label>
            <div>
              <input id="freeShip" className="form-check-input" type="checkbox" checked={filters.freeShipping} onChange={e=>setFilters(f=>({...f,freeShipping:e.target.checked}))} />
              <label htmlFor="freeShip" className="form-check-label ms-2 small muted">عرض فقط</label>
            </div>
          </div>

          <div className="col-6 col-md-2">
            <label className="form-label small">فرز</label>
            <select className="form-select" value={sortBy} onChange={e=>setSortBy(e.target.value)}>
              <option value="rating">التقييم الأعلى</option>
              <option value="name">الاسم (أ→ي)</option>
              <option value="delivery">أسرع توصيل</option>
            </select>
          </div>

          <div className="col-12 col-md-12 text-start">
            <button className="btn btn-outline-primary" onClick={clearAll}><i className="fa-solid fa-rotate me-1"></i> إعادة التصفية</button>
          </div>
        </div>
      </div>
    </div>
  );
}

function StoreCard({ s, isFav, toggleFav, openDetails, openSite }) {
  return (
    <div className="card-store card h-100" role="article">
      <img className="thumb" src={`https://source.unsplash.com/900x400/?${encodeURIComponent(s.name)},shop`} alt={s.name}/>
      <div className="p-3 d-flex flex-column" style={{gap:'.5rem'}}>
        <div className="d-flex align-items-center gap-2">
          <img src={favicon(s.domain)} width="28" height="28" style={{borderRadius:8}} alt="fav"/>
          <div>
            <div className="fw-semibold">{s.name}</div>
            <small className="muted">{s.type} • {s.country}</small>
          </div>
          <div className="ms-auto text-end">
            <div className="fw-bold">{s.rating} <i className="fa-solid fa-star text-warning ms-1"></i></div>
          </div>
        </div>

        <p className="muted small mb-1">{s.desc}</p>

        <div className="d-flex flex-wrap gap-1 mb-2">
          {s.tags.map(t=> <span key={t} className="tag">{t}</span>)}
          {s.freeShipping && <span className="tag"><i className="fa-solid fa-truck-fast me-1"></i>شحن مجاني</span>}
          {s.deliveryDays != null && <span className="tag"><i className="fa-solid fa-clock me-1"></i>{s.deliveryDays} يوم</span>}
        </div>

        <div className="mt-auto d-flex gap-2">
          <button className="btn btn-outline-primary" onClick={()=>openDetails(s)}><i className="fa-regular fa-circle-info me-1"></i> التفاصيل</button>
          <button className="btn btn-primary flex-grow-1" onClick={()=>openSite(s.url)}><i className="fa-solid fa-arrow-up-right-from-square me-1"></i> زيارة</button>
          <button className={isFav?"btn btn-danger":"btn btn-outline-danger"} onClick={()=>toggleFav(s.id)} title="مفضلة">
            <i className={isFav?"fa-solid fa-heart":"fa-regular fa-heart"}></i>
          </button>
        </div>
      </div>
    </div>
  );
}

function DetailsModal({ store, onClose }) {
  if(!store) return null;
  return (
    <>
      <div className="modal fade show" style={{display:"block"}} role="dialog" aria-modal="true">
        <div className="modal-dialog modal-lg modal-dialog-centered">
          <div className="modal-content">
            <div className="modal-header">
              <h5 className="modal-title"><i className="fa-solid fa-store me-2"></i>{store.name}</h5>
              <button className="btn-close" onClick={onClose}></button>
            </div>
            <div className="modal-body">
              <div className="row g-3">
                <div className="col-md-5">
                  <img src={`https://source.unsplash.com/800x600/?${encodeURIComponent(store.name)},store`} className="img-fluid rounded" alt="thumb"/>
                  <div className="mt-2">
                    <img src={favicon(store.domain)} alt="" width="24" height="24" className="me-2"/>
                    <a href={store.url} target="_blank" rel="noreferrer" className="small">{store.domain}</a>
                  </div>
                </div>
                <div className="col-md-7">
                  <p><strong>النوع:</strong> {store.type}</p>
                  <p><strong>البلد:</strong> {store.country}</p>
                  <p><strong>التصنيفات:</strong> {store.categories.join(" • ")}</p>
                  <p><strong>الوسوم:</strong> {store.tags.join(", ")}</p>
                  <p><strong>التقييم:</strong> {store.rating} / 5</p>
                  <p><strong>وصف:</strong> {store.desc}</p>
                  <p><strong>شحن مجاني:</strong> {store.freeShipping ? "نعم" : "لا"}</p>
                  <p><strong>مدة التوصيل تقريبية:</strong> {store.deliveryDays ? `${store.deliveryDays} يوم` : "غير محدد"}</p>
                </div>
              </div>
            </div>
            <div className="modal-footer">
              <a className="btn btn-primary" href={store.url} target="_blank" rel="noreferrer">زيارة الموقع</a>
              <button className="btn btn-secondary" onClick={onClose}>إغلاق</button>
            </div>
          </div>
        </div>
      </div>
      <div className="modal-backdrop fade show" onClick={onClose}></div>
    </>
  );
}

function FavoritesCanvas({ favItems, removeFav, openSite }) {
  return (
    <div className="offcanvas offcanvas-end" tabIndex="-1" id="favCanvas" aria-labelledby="favCanvasLabel">
      <div className="offcanvas-header">
        <h5 id="favCanvasLabel"><i className="fa-solid fa-heart text-danger me-2"></i>المفضلة ({favItems.length})</h5>
        <button type="button" className="btn-close" data-bs-dismiss="offcanvas" aria-label="إغلاق"></button>
      </div>
      <div className="offcanvas-body">
        {favItems.length===0 ? (
          <div className="text-muted">لم تضف متاجر للمفضلة بعد.</div>
        ) : (
          <ul className="list-group list-group-flush">
            {favItems.map((s,i)=>(
              <li key={s.id} className="list-group-item d-flex align-items-center" style={{animation:"fadeInUp .28s ease forwards", animationDelay:`${i*80}ms`, opacity:0}}>
                <img src={favicon(s.domain)} alt="" style={{width:44,height:44,objectFit:"cover"}} className="rounded me-2"/>
                <div className="flex-grow-1">
                  <div className="fw-semibold">{s.name}</div>
                  <small className="muted">{s.type} • {s.country}</small>
                </div>
                <button className="btn btn-sm btn-outline-success me-2" onClick={()=>openSite(s.url)}><i className="fa-solid fa-arrow-up-right-from-square"></i></button>
                <button className="btn btn-sm btn-outline-danger" onClick={()=>removeFav(s.id)}><i className="fa-solid fa-xmark"></i></button>
              </li>
            ))}
          </ul>
        )}
      </div>
    </div>
  );
}

/* ========== App ========== */

function App(){
  // theme
  const [theme, setTheme] = useState(getInitialTheme());
  useEffect(()=> applyTheme(theme), [theme]);

  // live clock
  const [timeStr, setTimeStr] = useState(new Date().toLocaleTimeString());
  useEffect(()=>{
    const t = setInterval(()=> setTimeStr(new Date().toLocaleTimeString()), 1000);
    return ()=> clearInterval(t);
  },[]);

  // search & filters
  const [query, setQuery] = useState("");
  const [filters, setFilters] = useState({ category:"", country:"", type:"", freeShipping:false });
  const [sortBy, setSortBy] = useState("rating");

  // favorites IDs
  const [favIds, setFavIds] = useState(()=> {
    try{ return JSON.parse(localStorage.getItem(FAV_KEY)) || []; } catch { return []; }
  });
  useEffect(()=> localStorage.setItem(FAV_KEY, JSON.stringify(favIds)), [favIds]);

  // details modal
  const [selected, setSelected] = useState(null);

  // fuse search (live — updates as user types)
  const fuse = useMemo(()=> new Fuse(STORES, {
    keys: ["name","tags","desc","categories"],
    threshold: 0.35,
    ignoreLocation: true
  }), []);

  const searched = useMemo(()=>{
    if(!query.trim()) return STORES;
    return fuse.search(query.trim()).map(r=>r.item);
  }, [query, fuse]);

  const filtered = useMemo(()=>{
    return searched.filter(s=>{
      if(filters.category && !s.categories.includes(filters.category)) return false;
      if(filters.country && s.country !== filters.country) return false;
      if(filters.type && s.type !== filters.type) return false;
      if(filters.freeShipping && !s.freeShipping) return false;
      return true;
    });
  }, [searched, filters]);

  const sorted = useMemo(()=>{
    const arr = [...filtered];
    if(sortBy==="name") arr.sort((a,b)=> a.name.localeCompare(b.name));
    else if(sortBy==="delivery") arr.sort((a,b)=> (a.deliveryDays||999) - (b.deliveryDays||999));
    else arr.sort((a,b)=> b.rating - a.rating);
    return arr;
  }, [filtered, sortBy]);

  // fav items
  const favItems = useMemo(()=> STORES.filter(s=> favIds.includes(s.id)), [favIds]);

  // actions
  function toggleFav(id){
    setFavIds(prev=>{
      if(prev.includes(id)){ notify("أُزيل من المفضلة","danger"); return prev.filter(x=>x!==id); }
      notify("أُضيف إلى المفضلة","success"); return [...prev,id];
    });
  }
  function removeFav(id){ setFavIds(prev=> prev.filter(x=>x!==id)); notify("أُزيل من المفضلة","danger"); }
  function openSite(url){ window.open(url, "_blank"); }

  function clearAll(){
    setQuery(""); setFilters({category:"",country:"",type:"", freeShipping:false}); setSortBy("rating");
  }

  useEffect(()=>{ if(window.AOS) AOS.init({duration:700, once:true}); }, []);

  return (
    <>
      <Topbar query={query} setQuery={setQuery} theme={theme} toggleTheme={()=>setTheme(t=>t==="dark"?"light":"dark")} favCount={favIds.length} timeStr={timeStr}/>
      <Hero/>
      <Filters filters={filters} setFilters={setFilters} sortBy={sortBy} setSortBy={setSortBy} clearAll={clearAll}/>

      <main className="container">
        <div className="d-flex justify-content-between align-items-center mb-2">
          <div className="muted">النتائج: <strong>{sorted.length}</strong></div>
          {query && <div className="small">بحث حي: <span className="badge bg-light text-dark">{query}</span></div>}
        </div>

        <div className="row g-3">
          {sorted.map(s=>(
            <div key={s.id} className="col-12 col-sm-6 col-md-4 col-lg-3" data-aos="fade-up">
              <StoreCard s={s} isFav={favIds.includes(s.id)} toggleFav={toggleFav} openDetails={(st)=>setSelected(st)} openSite={openSite}/>
            </div>
          ))}
        </div>

        {sorted.length === 0 && <div className="text-center muted my-5">لا توجد نتائج — جرّب كلمات أخرى أو عدّل الفلاتر.</div>}
      </main>

      <FavoritesCanvas favItems={favItems} removeFav={removeFav} openSite={openSite}/>

      <footer>
        <small>© {new Date().getFullYear()} — مُجمّع المتاجر • React + Fuse.js + AOS + Toastify — مشروع الدورة</small>
      </footer>

      {selected && <DetailsModal store={selected} onClose={()=>setSelected(null)}/>}
    </>
  );
}

/* ---------- render ---------- */
applyTheme(getInitialTheme());
ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
</script>
</body>
</html>
